---
title: 计算机网络问题
categories: study
tags : 面试
toc: true
---

# 计算机网络概述

- 传输速率就是发送速率
- 因特网的核心技术就是tcp/ip技术
- 现代互联网是由用户保证数据传送的可靠性（区别于电路）
- 分布式系统最大特点在于对于用户是透明的
- 计网最重要的两个性能指标，带宽和时延
- 计算机子网由通信网子网和主机和协议构成
- 网络层
  - OSI模型是  无连接和支持连接
  - tcp/ip是无连接
- 传输层
  - OSI模型是面向连接
  - TCP/IP是 面向连接和无连接
## 计算机网络体系结构

### osi七层

- 应用层 
  - 提供系统与用户的接口
  - FTP、SMTP、POP3、HTTP、DNS、TELnet
- 表示层
  - 处理两个系统中交换信息的表示方式
- 会话层  
  - 不同主机上的各个进程之间进行会话，建立同步，
- 传输层    报文段（tcp）  用户数据报（udp）
  - 连个主机之间的通信，端到端，流量控制，差错控制，服务质量，数据传输管理
- 网络层（网际层，ip层）   ip数据报
  - 对分组进行路由选择，流量控制，拥塞控制，差错控制，网际互连  分用复用
  - 路由器
  - ICMP、ARP、RARP、IP、IGMP、OSPF
- 数据链路层   --数据帧
  - 差错控制，流量控制，封装成帧，传输管理
- 物理层   --比特流
  - 透明地传输比特流,为数据段设备提供传送数据通路
  - 集线器，中继器

以太网协议头部 +ip头部+tcp\udp头部+应用程序数据 + 以太网尾部

46~1500字节 以太网数据部分

### Tcp/ip四层

- 应用层
- 传输层
- 网际层
- 网络接口层

### 教科书模型五层

- 应用层
- 传输层
- 网络层
- 数据链路层
- 物理层
# 网络原理
端系统通过通信链路和分组交换机连接在一起
# 物理层

- 计算机内部是并行传输

  

- 语音信号数字化的技术是脉冲编码调制

- 曼彻斯特编码的数据波特率是数据率的2倍

- 电路交换无法进行错误检测

- 出错率高的系统采用数据报方式比较好

  

- 曼彻斯特编码一位数据需要两个电平

- 报文交换不能用于实时通信

- 以太网使用曼彻斯特编码和分组交换，基带传输

  

- 虚电路包括临时的和永久性的

- 传统以太网是广播的方式传播信息

- 光纤不是中空的，一般用发光二极管或激光二极管

- 中继器是将信号再生

- 提高信噪比可以降低随机差错的干扰




- 争议期是指最远两个站点往这传输的时间

- hub为100 base -t的集线器，线路的传输率是100mb/s

- 传输传播处理，排队、时延



- 

# 数据链路层

- 二进制回退算法考虑了网络负载规模大小的影响

- 无线局域网不进行冲突检测

- 以太网逻辑上是总线型实际上是星型

- 以太网交换机不能隔离广播域

- 异构网络指的是物理层和数据链路层不同






- 海明码纠错d位需要2 d +1的码距检错需要d+1位

- TDM适合数字信号，FDA适合模拟信号





- IEEE802.3是种基带总线型局域网标准，用CSMA/CD标准，IEEE802.11采用csma/ca标准

- 码分多址，cdma

- 介质访问控制就是多址访问协议
	- 信道划分协议
	- 随机接入协议
	- 轮流协议或者轮询协议
	
- 以太网交换机是根据mac地址转发的

- 一个以太网不能用不同的子网号

- intra net使用的是b/s模式

- 以太网交换机通过直连交换方式转发分组时只检查首部地址，一般只接受首部6B的地址
# 网络层
- 在目的主机把分片数据组装

- 划分子网降低广播域，提高Ip地址利用率

- ARP请求是广播，响应是单播

- nat表项需要管理员手动添加，不符合的直接扔掉

- 子网划分平均子网划分和变子网划分

  

- ip v6不提供校验字段且首部长度固定

- 移动编码的技术分为信道编码和信源编码

- GSM的三种分配信道方式为立即指派，指派，切入指派

  0

- 防火墙技术分为应用层防火墙技术和网络层防火墙技术

- ipv6表示法
	- 点分十进制，
	- 冒号十六进制，
	- 零压缩法
	
- 路由选择算法广义的分类
	- 与分散式路由选择算法
	- 静态与动态路由选择算法
	
- ospf协议核心是Dijkstra算法

- 在距离矢量路由选择算法中，可以通过毒性逆转解决。

- 路由器的交换结构可以通过内存交换、总线交换，互联网络互换

- 移动ip标准由代里发现向归属代理注册，数据报间的回接路由选择三部分组

- 路由器中负责转发数据的是路由器转发平面



- 路由最重要的是下一跳地址和目标网络地址
- 

## ipv4 与 ipv6的区别
协议地址的区别

（1）地址长度

    IPv4协议具有32位（4字节）地址长度；IPv6协议具有128位（16字节）地址长度。

（2）地址的表示方法

    IPv4地址是以小数表示的二进制数。 IPv6地址是以十六进制表示的二进制数。

（3）地址配置

    IPv4协议的地址可以通过手动或DHCP配置的。

    IPv6协议需要使用Internet控制消息协议版本6（ICMPv6）或DHCPv6的无状态地址自动配置（SLAAC）。
数据包的区别

（1）包的大小

    IPv4协议的数据包需要576个字节，碎片可选 ；IPv6协议的数据包需要1280个字节，不会碎片。

（2）包头

    IPv4协议的包头的长度为20个字节，不识别用于QoS处理的数据包流，包含checksum，包含最多40个字节的选项字段。

    IPv6协议的包头的长度为40个字节，包含指定QoS处理的数据包流的Flow Label字段，不包含checksum；IPv6协议没有字段，但IPv6扩展标头可用。

（3）数据包碎片

IPv4协议的数据包碎片会由转发路由器和发送主机完成。IPv6协议的数据包碎片仅由发送主机完成。

DNS记录

IPv4协议的地址（A）记录，映射主机名；指针（PTR）记录，IN-ADDR.ARPA DNS域。

IPv6协议的地址（AAAA）记录，映射主机名；指针（PTR）记录，IP6.ARPA DNS域

IPSec支持

IPv4协议的IPSec支持只是可选的；IPv6协议有内置的IPSec支持。

地址解析协议

IPv4协议：地址解析协议（ARP）可用于将IPv4地址映射到MAC地址。

IPv6协议：地址解析协议（ARP）被邻居发现协议（NDP）的功能所取代。

身份验证和加密

Pv6提供身份验证和加密；但IPv4不提供

## ARP协议
ARP协议即地址解析协议，是根据IP地址获取MAC地址的一个网络层协议 

ARP首先会发起一个请求数据包，数据包的首部包含了目标主机的IP地址，然后这个数据包会在链路层进行再次包装，生成以太网数据包，最终由以太网广播给子网内的所有主机，每一台主机都会接收到这个数据包，并取出标头里的IP地址，然后和自己的IP地址进行比较，如果相同就返回自己的MAC地址，如果不同就丢弃该数据包。ARP接收返回消息，以此确定目标机的MAC地址；与此同时，ARP还会将返回的MAC地址与对应的IP地址存入本机ARP缓存中并保留一定时间，下次请求时直接查询ARP缓存以节约资源

## 路由协议
路由协议主要运行于路由器上，路由协议是用来确定到达路径的，起到一个地图导航，负责找路的作用。它工作在网络层。它包括RIP，IGRP（Cisco私有协议），EIGRP（Cisco私有协议），OSPF，IS-IS，BGP。
### RIP
    RIP很早就被用在Internet上，是最简单的路由协议。它是“路由信息协议（Route Information Protocol）”的简写，主要传递路由信息，通过每隔30秒广播一次路由表，维护相邻路由器的位置关系，同时根据收到的路由表信息计算自己的路由表信息。RIP是一个距离矢量路由协议，最大跳数为15跳，超过15跳的网络则认为目标网络不可达。此协议通常用在网络架构较为简单的小型网络环境。分为RIPv1和RIPv2两个版本，后者支持VLSM技术以及一系列技术上的改进。RIP的收敛速度较慢。

### IGRP（内部网关路由协议）

    IGRP协议是“内部网关路由协议（Interior Gateway Routing Protocol）”的缩写，由Cisco于二十世纪八十年代独立开发，属于Cisco私有协议。IGRP和RIP一样，同属距离矢量路由协议，因此在诸多方面有着相似点，如IGRP也是周期性的广播路由表，也存在最大跳数（默认为100跳，达到或超过100跳则认为目标网络不可达）。IGRP最大的特点是使用了混合度量值，同时考虑了链路的带宽、延迟、负载、MTU、可靠性5个方面来计算路由的度量值，而不像其他IGP协议单纯的考虑某一个方面来计算度量值。IGRP已经被Cisco独立开发的EIGRP协议所取代，版本号为12.3及其以上的Cisco IOS（Internetwork Operating System）已经不支持该协议，已经罕有运行IGRP协议的网络。

### EIGRP（增强型内部网关路由协议）

    由于IGRP协议的种种缺陷以及不足，Cisco开发了EIGRP协议（增强型内部网关路由协议）来取代IGRP协议。EIGRP属于高级距离矢量路由协议（又称混合型路由协议），继承了IGRP的混合度量值，最大特点在于引入了非等价负载均衡技术，并拥有极快的收敛速度。EIGRP协议在Cisco设备网络环境中广泛部署。

### OSPF（开放式最短路径优先）

    OSPF协议是“开放式最短路径优先（Open Shortest Path First）”的缩写，属于链路状态路由协议。OSPF提出了“区域（area）”的概念，每个区域中所有路由器维护着一个相同的链路状态数据库（LSDB）。区域又分为骨干区域（骨干区域的编号必须为0）和非骨干区域（非0编号区域），如果一个运行OSPF的网络只存在单一区域，则该区域可以是骨干区域或者非骨干区域。如果该网络存在多个区域，那么必须存在骨干区域，并且所有非骨干区域必须和骨干区域直接相连。OSPF利用所维护的链路状态数据库，通过最短路径优先算法（SPF算法）计算得到路由表。OSPF的收敛速度较快。由于其特有的开放性以及良好的扩展性，OSPF协议在各种网络中广泛部署。

### IS-IS（中间系统到中间系统）

    IS-IS协议是Intermediate system to intermediate system（中间系统到中间系统）的缩写，属于链路状态路由协议。标准IS-IS协议是由国际标准化组织制定的ISO/IEC 10589:2002所定义的，标准IS-IS不适合用于IP网络，因此IETF制定了适用于IP网络的集成化IS-IS协议（Integrated IS-IS）。和OSPF相同，IS-IS也使用了“区域”的概念，同样也维护着一份链路状态数据库，通过最短生成树算法（SPF）计算出最佳路径。IS-IS的收敛速度较快。集成化IS-IS协议是ISP骨干网上最常用的IGP协议。

### BGP（边界网关协议）

    为了维护各个ISP的独立利益，标准化组织制定了ISP间的路由协议BGP。BGP是“边界网关协议（Border Gateway Protocol）”的缩写，处理各ISP之间的路由传递。但是BGP运行在相对核心的地位，需要用户对网络的结构有相当的了解，否则可能会造成较大损失。

# 传输层
- 端到端的通信是主机的进程之间的通信
- 二进制回退算法考虑了网络负载规模大小的影响
- 无线局城网不进行冲突检测
- 争用期
- 可靠指的是收到数据后的确认机制，序号和确认号
- ip层的TCP17，udp为6
- TCP对报文段确认但是按字节编号
- 线路效率为吞吐率：带宽
- udp通过目的端口实现的分用

端口号就是用来标识应用进程的数字标识。其端口号的长度为16Bit;也就是能够标识2^16个不同的端口号。另外端口号根据端口范围分为2类。分别为服务端使用的端口号（熟知端口号数值范围：0-1023；登记端口号数值范围：1024-49151）和客户端使用的端口号（数值范围为49152-65535）。常见端口号如下：

- FTP：21
- TELNET：23
- SMTP：25
- DNS：53
- TFTP：69
- HTTP：80
- SNMP：161

### 三次握手
第一次握手：建立连接时，客户端发送syn包（syn=x）到服务器，并进入SYN_SENT状态，等待服务器确认；SYN：同步序列编号（Synchronize Sequence Numbers）。

第二次握手：服务器收到syn包，必须确认客户的SYN（ack=x+1），同时自己也发送一个SYN包（syn=y），即SYN+ACK包，此时服务器进入SYN_RECV状态；

第三次握手：客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK(ack=y+1），此包发送完毕，客户端和服务器进入ESTABLISHED（TCP连接成功）状态，完成三次握手。

### 四次握手
客户端进程发出连接释放报文，并且停止发送数据。释放数据报文首部，FIN=1，其序列号为seq=u（等于前面已经传送过来的数据的最后一个字节的序号加1），此时，客户端进入FIN-WAIT-1（终止等待1）状态。 TCP规定，FIN报文段即使不携带数据，也要消耗一个序号。

服务器收到连接释放报文，发出确认报文，ACK=1，ack=u+1，并且带上自己的序列号seq=v，此时，服务端就进入了CLOSE-WAIT（关闭等待）状态。TCP服务器通知高层的应用进程，客户端向服务器的方向就释放了，这时候处于半关闭状态，即客户端已经没有数据要发送了，但是服务器若发送数据，客户端依然要接受。这个状态还要持续一段时间，也就是整个CLOSE-WAIT状态持续的时间。

客户端收到服务器的确认请求后，此时，客户端就进入FIN-WAIT-2（终止等待2）状态，等待服务器发送连接释放报文（在这之前还需要接受服务器发送的最后的数据）。

服务器将最后的数据发送完毕后，就向客户端发送连接释放报文，FIN=1，ack=u+1，由于在半关闭状态，服务器很可能又发送了一些数据，假定此时的序列号为seq=w，此时，服务器就进入了LAST-ACK（最后确认）状态，等待客户端的确认。

客户端收到服务器的连接释放报文后，必须发出确认，ACK=1，ack=w+1，而自己的序列号是seq=u+1，此时，客户端就进入了TIME-WAIT（时间等待）状态。注意此时TCP连接还没有释放，必须经过2∗∗MSL（最长报文段寿命）的时间后，当客户端撤销相应的TCB后，才进入CLOSED状态。

服务器只要收到了客户端发出的确认，立即进入CLOSED状态。同样，撤销TCB后，就结束了这次的TCP连接。可以看到，服务器结束TCP连接的时间要比客户端早一些。

#### 简单概括

四次挥手过程

（1）客户端向服务器发送FIN控制报文段（首部中的 FIN 比特被置位）；

（2）服务端收到FIN，回复ACK。服务器进入关闭等待状态，发送FIN;

（3）客户端收到FIN，给服务器回复ACK，客户端进入等待状态（进入“等待”，以确保服务器收到ACK真正关闭连接）;

（4）服务端收到ACK，链接关闭。

#### tcp与udp的区别
    TCP和UDP有如下区别：

连接：TCP面向连接的传输层协议，即传输数据之前必须先建立好连接；UDP无连接。

服务对象：TCP点对点的两点间服务，即一条TCP连接只能有两个端点；UDP支持一对一，一对多，多对一，多对多的交互通信。

可靠性：TCP可靠交付：无差错，不丢失，不重复，按序到达；UDP尽最大努力交付，不保证可靠交付。

拥塞控制/流量控制：有拥塞控制和流量控制保证数据传输的安全性；UDP没有拥塞控制，网络拥塞不会影响源主机的发送效率。

报文长度：TCP动态报文长度，即TCP报文长度是根据接收方的窗口大小和当前网络拥塞情况决定的；UDP面向报文，不合并，不拆分，保留上面传下来报文的边界。

首部开销：TCP首部开销大，首部20个字节；UDP首部开销小，8字节（源端口，目的端口，数据长度，校验和）。

适用场景（由特性决定）：数据完整性需让位于通信实时性，则应该选用TCP 协议（如文件传输、重要状态的更新等）；反之，则使用 UDP 协议（如视频传输、实时通信等）。


## udp
> 让udp更可靠一点

应用层去实现，超时重传，通过确认序列号

已经实现的可靠UDP：
（1）RUDP 可靠数据报传输协议；

（2）RTP 实时传输协议
（3）UDT
基于UDP的数据传输协议，是一种互联网传输协议；
主要目的是支持高速广域网上的海量数据传输，引入了新的拥塞控制和数据可靠性控制机制（互联网上的标准数据传输协议TCP在高带宽长距离的网络上性能很差）；
UDT是面向连接的双向的应用层协议，同时支持可靠的数据流传输和部分可靠的数据报服务；
应用：高速数据传输，点到点技术(P2P)，防火墙穿透，多媒体数据传输

## tcp
所谓流量控制就是让发送发送速率不要过快，让接收方来得及接收。

TCP控制流量的方法

利用滑动窗口机制就可以实施流量控制。

原理就是运用TCP报文段中的窗口大小字段来控制，发送方的发送窗口不可以大于接收方发回的窗口大小。考虑一种特殊的情况，就是接收方若没有缓存足够使用，就会发送零窗口大小的报文，此时发送放将发送窗口设置为0，停止发送数据。之后接收方有足够的缓存，发送了非零窗口大小的报文，但是这个报文在中途丢失的，那么发送方的发送窗口就一直为零导致死锁。

解决这个问题，TCP为每一个连接设置一个持续计时器（persistence timer）。只要TCP的一方收到对方的零窗口通知，就启动该计时器，周期性的发送一个零窗口探测报文段。对方就在确认这个报文的时候给出现在的窗口大小（注意：TCP规定，即使设置为零窗口，也必须接收以下几种报文段：零窗口探测报文段、确认报文段和携带紧急数据的报文段）。


为了提高信道的利用率TCP协议不使用停止等待协议，而是使用连续ARQ协议，意思就是可以连续发出若干个分组然后等待确认，而不是发送一个分组就停止并等待该分组的确认。
### tcp拥塞控制
拥塞控制

TCP传输的过程中，发送端开始发送数据的时候，如果刚开始就发送大量的数据，那么就可能造成一些问题。网络可能在开始的时候就很拥堵，如果给网络中在扔出大量数据，那么这个拥堵就会加剧。拥堵的加剧就会产生大量的丢包，就对大量的超时重传，严重影响传输。

所以TCP引入了慢启动的机制，在开始发送数据时，先发送少量的数据探路。探清当前的网络状态如何，再决定多大的速度进行传输。这时候就引入一个叫做拥塞窗口的概念。发送刚开始定义拥塞窗口为 1，每次收到ACK应答，拥塞窗口加 1。在发送数据之前，首先将拥塞窗口与接收端反馈的窗口大小比对，取较小的值作为实际发送的窗口。

拥塞窗口的增长是指数级别的。慢启动的机制只是说明在开始的时候发送的少，发送的慢，但是增长的速度是非常快的。为了控制拥塞窗口的增长，不能使拥塞窗口单纯的加倍，设置一个拥塞窗口的阈值，当拥塞窗口大小超过阈值时，不能再按照指数来增长，而是线性的增长。在慢启动开始的时候，慢启动的阈值等于窗口的最大值，一旦造成网络拥塞，发生超时重传时，慢启动的阈值会为原来的一半（这里的原来指的是发生网络拥塞时拥塞窗口的大小），同时拥塞窗口重置为 1。


>TCP拥塞控制的四种算法：慢开始、拥塞避免、快重传、快恢复。

（1）慢开始算法：当主机开始发送数据时，并不清楚网络的负载情况，所以由小到大逐渐增大拥塞窗口，每经过一个传输轮次没有出现超时就将拥塞窗口加倍。同时还需要设置一个慢开始门限，在拥塞窗口小于慢开始门限时使用慢开始算法，大于慢开始门限时，使用拥塞避免算法；

（2）拥塞避免算法：在拥塞窗口大于慢开始门限时，让拥塞窗口按线性规律缓慢增长。即每经过一个传输轮次，拥塞窗口增大一个MSS最大报文段尺寸。（拥塞避免并非完全能够避免拥塞，只是使网络比较不容易出现拥塞）

（3）快重传算法：使发送方今早知道发生了个别报文段丢失，并不是出现网络拥塞。

要求接受不要阻塞自己发送数据时才进行捎带确认，而是立即发送确认，即使收到了失序的报文段也要立即发出对已收到报文段的重复确认。而发送方一旦受到三个连续的重读确认，就将相应的报文段立即重传。

（4）快恢复算法：发送方知道只有个别报文段丢失而不是网络拥塞时，不启动慢开始算法，而是执行快恢复算法，将慢开始门限和拥塞窗口值调整为当前窗口的一半，开始执行拥塞避免算法    
### tcp reset
tcp的异常终止，停止发送缓冲区的报文，异常关闭连接

### HTTP2.0中TCP阻塞了怎么办？
HTTP2.0中TCP阻塞了有如下两种方法可以解决：

- （1）并发TCP连接（浏览器一个域名采用6-8个TCP连接，并发HTTP请求）     
- （2）域名分片（多个域名，可以建立更多的TCP连接，从而提高HTTP请求的并发）

### 报文乱序

数据包会因为IP层所规划的路由链路的不同导致数据包的接收顺序与发送顺序会有所不同。另外因为TCP是一种全双工的协议，乱序可能发生在正向链路，也可能发生在反向链路，这两种不同的情况给TCP带来的影响也会略有差异。

- 正向链路乱序

此时TCP会无法判断是数据包丢失还是乱序，因为丢包和乱序都会导致接收端收到次序混乱的数据包，造成接收端的数据空洞。TCP会将这种情况暂定为数据包的乱序，因为乱序是时间问题（可能是数据包的迟到），而丢包则意味着重传。当TCP意识到包出现乱序的情况时，会立即ACK，该ACK的TSER部分包含的TSEV值会记录当前接收端收到有序报文段的时刻。这会使得数据包的RTT样本值增大，进一步导致RTO时间延长。这对TCP来说无疑是有益的，因为TCP有充分的时间判断数据包到底是失序还是丢了来防止不必要的数据重传。当然严重的乱序则会让发送端以为是丢包一旦重复的ACK超过TCP的阈值，便会触发超时重传机制，以及时解决这种问题。

- 反向链路（ACK）乱序

顾名思义，如果发生这种情况，就会导致发送端窗口快速前移，这会导致发送端出现不必要的流量突发，影响网络带宽。

## 缓冲区
I/O缓冲区特性

（1）I/O缓冲区在每个TCP套接字中单独存在；

（2）I/O缓冲区在创建套接字时自动生成；

（3）即使关闭套接字也会继续传送输出缓冲区中遗留的数据；

（4）关闭套接字将丢失输入缓冲区中的数据。

输入输出缓冲区的默认大小一般都是 8K，可以通过 getsockopt() 函数获取：
# 应用层
- 匿名用户FTP的id是anonymous
- pop3在传输层是不对信息加密的
- cookie由服务器产生
- connections：close表示非连续，keep-alive为连续

  应用层的具体内容就是规定应用进程在通信时所遵循的协议。应用层协议分类如下：

- (1). 域名系统(Domain Name System，DNS)：用于实现网络设备名字到IP地址映射的网络服务。
- (2). 文件传输协议(File Transfer Protocol，FTP)：用于实现交互式文件传输功能。
- (3). 简单邮件传送协议(Simple Mail Transfer Protocol, SMTP)：用于实现电子邮箱传送功能
- (4). 超文本传输协议(HyperText Transfer Protocol，HTTP)：用于实现WWW服务。
- (5). 简单网络管理协议(simple Network Management Protocol，SNMP)：用于管理与监视网络设备。
- (6). 远程登录协议(Telnet)：用于实现远程登录功能。


## http
HTTP 协议一共有五大特点：
- a. 支持客户/服务器模式；
- b. 简单快速；
- c. 灵活；
- d. 无连接；
  - 限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。
- e. 无状态。
  - 指协议对于事务处理没有记忆能力，服务器不知道客户端是什么状态。即我们给服务器发送 HTTP 请求之后，服务器根据请求，会给我们发送数据过来，但是，发送完，不会记录任何信息

### http基于tcp
 HTTP是基于TCP的。

    HTTP协议是建立在请求/响应模型上的。首先由客户建立一条与服务器的TCP链接，并发送一个请求到服务器，请求中包含请求方法、URI、协议版本以及 相关的MIME样式的消息。服务器响应一个状态行，包含消息的协议版本、一个成功和失败码以及相关的MIME式样的消息。     HTTP/1.0为每一次HTTP的请求/响应建立一条新的TCP链接，因此一个包含HTML内容和图片的页面将需要建立多次的短期的TCP链接。一次TCP链接的建立将需要3次握手。     另 外，为了获得适当的传输速度，则需要TCP花费额外的回路链接时间（RTT）。每一次链接的建立需要这种经常性的开销，而其并不带有实际有用的数据，只是 保证链接的可靠性，因此HTTP/1.1提出了可持续链接的实现方法。HTTP/1.1将只建立一次TCP的链接而重复地使用它传输一系列的请求/响应消 息，因此减少了链接建立的次数和经常性的链接开销。

### http1.1和http2.0

>HTTP1.1和HTTP2.0有什么区别？

HTTP2.0使用了多路复用的技术，做到同一个连接并发处理多个请求，而且并发请求的数量比HTTP1.1大了好几个数量级。HTTP1.1也可以多建立几个TCP连接，来支持处理更多并发的请求，但是创建TCP连接本身也是有开销的。

在HTTP1.1中，HTTP请求和响应都是由状态行、请求/响应头部、消息主体三部分组成。一般而言，消息主体都会经过gzip压缩，或者本身传输的就是压缩过后的二进制文件，但状态行和头部却没有经过任何压缩，直接以纯文本传输。随着Web功能越来越复杂，每个页面产生的请求数也越来越多，导致消耗在头部的流量越来越多，尤其是每次都要传输UserAgent、Cookie这类不会频繁变动的内容，完全是一种浪费。 HTTP1.1不支持header数据的压缩，HTTP2.0使用HPACK算法对header的数据进行压缩，这样数据体积小了，在网络上传输就会更快。

服务端推送是一种在客户端请求之前发送数据的机制。网页使用了许多资源：HTML、样式表、脚本、图片等等。在HTTP1.1中这些资源每一个都必须明确地请求。这是一个很慢的过程。浏览器从获取HTML开始，然后在它解析和评估页面的时候，增量地获取更多的资源。因为服务器必须等待浏览器做每一个请求，网络经常是空闲的和未充分使用的。

为了改善延迟，HTTP2.0引入了server push，它允许服务端推送资源给浏览器，在浏览器明确地请求之前，免得客户端再次创建连接发送请求到服务器端获取。这样客户端可以直接从本地加载这些资源，不用再通过网络。

### HTTP2.0和HTTP3.0有什么区别？

    HTTP2.0和HTTP3.0的区别在于前者使用tcp协议而后者使用udp协议。
### http与https
> https和https主要存在以下的区别：

HTTPS 协议需要到 CA （Certificate Authority，证书颁发机构）申请证书，一般免费证书较少，因而需要一定费用。(以前的网易官网是http，而网易邮箱是 https 。)

HTTP 是超文本传输协议，信息是明文传输，HTTPS 则是具有安全性的 SSL 加密传输协议。

HTTP 和 HTTPS 使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443。

HTTP 的连接很简单，是无状态的。HTTPS 协议是由 SSL+HTTP 协议构建的可进行加密传输、身份认证的网络协议，比 HTTP 协议安全。(无状态的意思是其数据包的发送、传输和接收都是相互独立的。无连接的意思是指通信双方都不长久的维持对方的任何信息。)

> https为什么采用混合加密机制？

    一方面，第一阶段的非对称加密，保证了对称密钥的安全性；另一方面，第二阶段的对称加密，可以提高加密/解密处理的速度，提高数据传输的效率。

### 状态码
>为什么302 重定向和网址劫持有关联

    从网址A 做一个302 重定向到网址B 时，主机服务器的隐含意思是网址A 随时有可能改主意，重新显示本身的内容或转向其他的地方。大部分的搜索引擎在大部分情况下，当收到302 重定向时，一般只要去抓取目标网址就可以了，也就是说网址B。如果搜索引擎在遇到302 转向时，百分之百的都抓取目标网址B 的话，就不用担心网址URL 劫持了。问题就在于，有的时候搜索引擎，尤其是Google，并不能总是抓取目标网址。

    比如说，有的时候A 网址很短，但是它做了一个302 重定向到B 网址，而B 网址是一个很长的乱七八糟的URL 网址，甚至还有可能包含一些问号之类的参数。很自然的，A 网址更加用户友好，而B 网址既难看，又不用户友好。这时Google 很有可能会仍然显示网址A。由于搜索引擎排名算法只是程序而不是人，在遇到302 重定向的时候，并不能像人一样的去准确判定哪一个网址更适当，这就造成了网址URL 劫持的可能性。也就是说，一个不道德的人在他自己的网址A 做一个302 重定向到你的网址B，出于某种原因， Google 搜索结果所显示的仍然是网址A，但是所用的网页内容却是你的网址B 上的内容，这种情况就叫做网址URL 劫持。你辛辛苦苦所写的内容就这样被别人偷走了。

    302 重定向所造成的网址URL 劫持现象，已经存在一段时间了。不过到目前为止，似乎也没有什么更好的解决方法。在正在进行的数据中心转换中，302 重定向问题也是要被解决的目标之一。从一些搜索结果来看，网址劫持现象有所改善，但是并没有完全解决。
## ftp
FTP 使用两个并行的 TCP 连接来传输文件

（1）控制连接（持久）：传输控制信息，如用户标识、口令、改变远程目录命令、文件获取上传的命令；

（2）数据连接（非持久）：传输实际文件

FTP 客户机发起向 FTP 服务器的控制连接，然后在该连接上发送用户标识和口令、改变远程目录的命令。FTP服务器收到命令后，发起一个到客户机的数据连接，在该连接上准确地传送一个文件并关闭连接。

有状态的协议：FTP 服务器在整个会话期间保留用户的状态信息。服务器必须把特定的用户账号和控制连接联系起来。

## 直播协议 RTMP，RTSP
直播可能需要使用到什么样的协议？


    视频直播有多种协议，使用rtmp协议的就是rtmp直播。直播流就是视频流，即传递的视频数据。常见的协议有RTMP、RTSP、HTTP协议，这三个协议都属于互联网TCP/IP五层体系结构中应用层的协议。理论上这三种都可以用来做视频直播或点播。但通常来说，直播一般用RTMP、RTSP，而点播用HTTP。下面分别介绍下三者的特点。

RTMP协议

（1）是流媒体协议；

（2）RTMP协议是Adobe的私有协议，未完全公开；

（3）RTMP协议一般传输的是flv，f4v格式流；

（4）RTMP一般在TCP1个通道上传输命令和数据。

RTSP协议

（1）是流媒体协议；

（2）RTSP协议是共有协议，并有专门机构做维护；

（3）RTSP协议一般传输的是ts、mp4格式的流；

（4）RTSP传输一般需要2-3个通道，命令和数据通道分离。

HTTP协议

（1）不是是流媒体协议；

（2）HTTP协议是共有协议，并有专门机构做维护；

（3）HTTP协议没有特定的传输流；

（4）HTTP传输一般需要2-3个通道，命令和数据通道分离
# 其他
## socket
> 提高socket的性能

- 最小化报文传输的延时。
  - nagle算法
- 最小化系统调用的负载。
- 为 Bandwidth Delay Product 调节 TCP 窗口。
  - 根据网络情况设置tcp的缓存大小
- 动态优化 GNU/Linux TCP/IP 栈。
  - 内核参数，操作系统动态配置


