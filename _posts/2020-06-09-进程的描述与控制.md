---
title: 进程的描述与控制
categories: study
tags : 操作系统复习
toc: true
---



# 程序的并发执行
## 程序顺序执行具有以下特点

顺序性 封闭性 可再现性

## 特点
①间断性  ②失去封闭性   ③不可再现性

## 概念
   在同一时间间隔内运行多个程序，一个程序还没有执行完，可以运行其它的程序，对用户而言，看到的是计算机同时运行多个程序
>   程序并发执行的方式可以是多CPU，也可以是多个程序分时使用一个CPU

# 进程的描述
## 定义

 - 进程是允许并发执行的程序在某个数据集合上的执行过程。
 - 进程是由用户数据、系统数据和程序构成的实体

## 特征
并发性
动态性
独立性
异步性
结构特征

## 进程与程序的比较
区别      

 - ①程序是静态的概念，进程是动态的概念
 - ②程序是永久的，进程是暂时存在的
 - ③程序与进程的存在实体不同


联系      

 - ①进程是程序的一次执行，进程总是对应一个特定的程序，执行程序的代码，一个进程必然对应至少一段程序。
 - ②一个程序可以对应多个进程。同一个程序段可以在不同的数据集合上运行，因而构成若干个不同的进程。 (几个进程能并发地执行同一程序，而同一个进程能顺序地执行几个程序p18《深入理解Linux内核》）
## 进程控制块（Process Control Block，PCB）

>进程控制块是进程实体的一部分，是操作系统中最重要的记录型数据结构，PCB中记录了操作系统所需要的用于描述进程情况及控制进程运行所需的全部信息

### 进程控制块中的信息

 - 进程标示符信息
 - 处理机状态信息
 - 进程调度信息
 - 进程控制信息

### 进程的组织

 - 链接方式
 - 结构数组
# 进程的基本状态
 - 就绪状态：进程一旦获得CPU就可以投入运行的状态
 - 执行状态：进程获得CPU正在运行的状态
 - 阻塞状态：进程由于等待资源或某个事件的发生而暂停执行的状态。
![进程状态转换](https://img-blog.csdnimg.cn/2020060914102671.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1MzQxOTE0,size_16,color_FFFFFF,t_70)
> 进程队列 就绪队列，阻塞队列。

## 进程的创建
引起创建进程的事件
  ① 用户登录
  ② 作业调度
  ③ 提供服务
  ④ 应用请求     

### 进程创建步骤
  ① 申请空白PCB
  ② 为新进程分配资源
  ③ 初始化进程控制块
  ④ 将新进程插入就绪队列

## 进程的阻塞
引起进程阻塞和唤醒的事件
 - ①请求系统服务，如：打印服务。
 - ②启动某种操作，如：启动I/O或启动打印机。
 - ③ 新数据尚未到达，如：一个计算进程，如果新的输入数据还没有到达，则计算进程需要阻塞等待。       
 - ④无新工作可做，发送一消息之后等待的时候
### 进程阻塞的简化过程

 - ①暂停进程的执行，将进程的状态改为阻塞态。
 - ②将进程插入相应的阻塞队列。
 - ③转进程调度例程，重新进行进程调度。

## 进程的唤醒

### 进程唤醒过程

 - ①将进程从阻塞队列中移出
 - ②将进程状态由阻塞改为就绪
 - ③将进程插入就绪队列
## 进程终止 
引起进程终止的事件
 - ①正常结束
 - ②异常结束
 - ③外界干预

### 进程终止过程
 - ①从进程PCB中读进程状态
 - ②若进程正在执行则终止进程的执行
 - ③若进程有子孙进程则终止子孙进程*(不一定）
 - ④释放资源
 - ⑤将终止进程的PCB“移”出

![操作系统的启动和系统进程的出现](https://img-blog.csdnimg.cn/20200609142750587.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1MzQxOTE0,size_16,color_FFFFFF,t_70)
# 操作系统内核

> 操作系统内核是计算机硬件的第一次扩充，内核执行OS与硬件关系密切，执行频率高的模块，常驻内存

## 内核功能
支撑功能
              
 - 中断处理、时钟管理、原语操作

资源管理功能
          
 - 进程管理、存储器管理、设备管理
### 中断

> 中断是改变处理器执行指令顺序的一种事件。这样的事件与CPU芯片内外部硬件电路产生的电信号相对应 

硬件隐指令 ：关中断，保存断点，引导中断程序执行

引入中断好处:引入中断机制后，CPU可以与其它设备并行工作，能有效提高CPU的利用率，改善系统性能，支持系统的异步性。
#### 中断类型

 - 同步中断（内部中断或异常） 除法出错、调试、溢出、浮点出错、页故障 …
 - 异步中断（外部中断）
       I . 外部可屏蔽中断（I/O设备产生的中断）
       II. 外部不可屏蔽中断（紧急事件引起的中断,如硬件故障）

>  一个屏蔽的中断只要还是屏蔽的，控制单元就忽略它。当eflags寄存器的IF标志被清0时，由PIC发布的每个可屏蔽中断都由CPU暂时忽略。 Linux中用cli和sti汇编指令分别清除和设置该标志。
#### 中断原因
 - 人为设置中断：在程序中人为设置中断。
 - 程序性事故：计算中出现除数为0
 - 硬件故障：插件接触不良、电源掉电等。 
 - I/O设备：I/O设备被启动以后，一旦其准备就绪，便向  CPU发出中断请求。
 -  外部事件：如用户通过键盘来中断现行程序 
#### 中断响应
响应中断的条件:开中断
响应外部中断的时机:CPU每执行完一条指令
**找到中断服务子例程**
不同中断源对应不同的中断向量
根据中断向量查找中断向量表
从中断向量表中的表项中读取中断处理子程序的入口地址相关信息
中断向量表 ：idtr+中断向量*中断向量表表项长度
> 对不同中断源到来的信号编号，编号是一个无符号整数，称之为中断向量

> 不可屏蔽中断的向量和异常的向量是固定的，而可屏蔽中断的向量可以通过对中断控制器的编程来改变

中断描述符表IDT

> 中断描述符表用来存放中断子程序的入口地址相关的信息。在OS初始化时由OS执行汇编指令lidt加载进入内存(idtr寄存器中)
### 时钟管理

#### 时钟作用

 - 定时测量       
 - 编译程序
 -  防止进程垄断CPU或其他资源 
 - 与时钟相关的软件需要时钟支持
#### 计算机系统中的时钟源
 - RTC时钟也叫CMOS时钟，是一块时钟芯片，靠电池电，为计算机提供计时标准，是最原始、最底层的数据。
 - OS时钟产生于PC主板上的定时/计数芯片，在开机时有效，由 OS控制。
 ![时钟运作机制](https://img-blog.csdnimg.cn/20200609155256373.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1MzQxOTE0,size_16,color_FFFFFF,t_70)
  主要定时测量

 - 一是保存当前的日期和时间；
 - 二是维持定时器

> 操作系统依靠时钟硬件（可编程间隔定时器PIT）和时钟软件（时钟驱动程序）实现上述两种定时测量功能

   硬件 
   	测量逝去的时间
   软件
    ①维护日期、时间
     ②递减时间片并检查是否为零，防止进程运行超时
     ③对 CPU的使用情况记帐
     ④递减报警计数器
> 时钟滴答 输出脉冲的一个周期
linux 为10msLinux的时间基准是1970年1月1日凌晨0点。
全局变量jiffes表示系统启动以来的时钟滴答数。
### 系统调用
#### 概念
系统调用是一群预先定义好的模块,它们提供一条管道。让应用程序或一般用户能由此得到核心程序的服务。系统调用是核心程序与用户程序之间的接口
#### 系统调用与一般函数的区别

 - 系统调用运行在系统态（核心态）而一般函数运行在用户态。 
 - 系统调用与一般函数调用的执行过程是不同的。当系统调用执行时，当前进程被trap指令中断，由系统找相应的系统调用子程序，并在核心态下执行，执行结果返回进程。  
 - 系统调用要进行“中断处理”比一般函数调用多了一些系统开销
#### linux的系统调用
 - system_call() 
 - 系统调用号:与系统调用一一对应的整数 
 - 系统调用表:存系统调用实现例程起始地址的数据结构，由系统在系统初始化时建立。
##### 调用过程
 - 保存系统调用号
 - 执行陷入指令，陷入内核态
 - 根据系统调用号到系统调用表内找到例程的入口地址。
 - 执行系统调用实现例程
 - 返回用户态
 系统调用表的起始地址+系统调用号*系统调用表表项
##### Linux中的系统调用举例
 - fork创建一个新进程 
 - clone按指定条件创建子进程 
 - execve运行可执行文件
 - exit中止进程；_exit立即中止当前进getdtablesize进程所能打开的最大文件数getpgid获取指定进程组标识号
# 线程
## 概念

> 轻量级进程，系统开销小

线程是进程中的一个实体，是被系统独立调度和分派的基本单位。线程只拥有在运行中必需的资源，包括程序计数器、一组寄存器和栈，但它可以与同属一个进程的其他线程共享进程的全部资源。
## 按实现方式分类
 - 用户级线程
 -  内核级线程
## 三种状态
 - 就绪  就绪线程队列
 - 运行  堵塞线程队列
 - 堵塞 执行线程队列
## 线程控制块TCB
### 线程控制块概念
  每个线程都由一个数据结构表示，包括它的基本状态、标识以及记账信息。
### 线程控制块中的信息

 - ①线程标示符信息
 - ②处理机状态信息
 - ③线程调度信息
 - ④线程控制信息
## 线程控制
### 线程的创建
用户线程的创建
内核线程的创建
### 线程的终止
#### 引起线程终止的原因
    ①正常结束
    ②异常结束
    ③外界干预
#### 线程的终止过程

 - ①根据被终止线程的标示符，从TCB集合中检索出该线程的TCB，从中读出该线程的状态
 - ②若被终止线程正处于运行状态，应立即终止该线程的 执行，并置调度标志为真，用于指示该线程被终止后应重新进行线程调度
 - ③将被终止线程的TCB从所在队列（或链表）中移出 等待其他程序来搜集信息
### 线程的调度与切换
用户线程的调度与切换
内核线程的调度与切换
#### 引起线程阻塞的事件
    ①请求系统服务
    ②启动某种服务
    ③新数据尚未到达
用户线程的阻塞与唤醒
内核线程的阻塞与唤醒
### 线程同步
保证诸线程以互斥的方式访问临界资源， 以使它们互不干扰且互不破坏数据结构。线程同步的机制有原语操作和信号量机制
### 线程通信
线程通信是指线程之间的消息交换由于同一进程中线程间共享内存和文件资源，各线程间可以通过直接读/写全局变量来进行通信，甚至无需操作系统内核的参与。对于不同进程的线程间通信，必须采用操作系统提供的线程 间通信机制。

